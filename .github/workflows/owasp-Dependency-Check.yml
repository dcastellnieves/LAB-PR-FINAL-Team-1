name: OWASP Dependency-Check

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  dependency-check:
    runs-on: ubuntu-latest

    steps:
    # Checkout repository code
    - name: Checkout code
      uses: actions/checkout@v3

    # Run OWASP Dependency-Check using Docker
    - name: Run OWASP Dependency-Check
      run: |
        DATA_DIR="dc-data-$GITHUB_RUN_ID"
        mkdir -p "$DATA_DIR"
        docker run --rm \
          --volume "$(pwd):/src" \
          --volume "$(pwd)/$DATA_DIR:/usr/share/dependency-check/data" \
          --volume "$(pwd)/dc-reports:/report" \
          owasp/dependency-check:latest \
          --scan /src \
          --format "ALL" \
          --project "Maven Project" \
          --out /report
    
    # Cleanup temporary data directory
    - name: Cleanup
      run: rm -rf "dc-data-$GITHUB_RUN_ID"

    # Upload the Dependency-Check report as an artifact
    - name: Upload Dependency-Check report
      uses: actions/upload-artifact@v4
      with:
        name: dependency-check-report
        path: dc-reports
